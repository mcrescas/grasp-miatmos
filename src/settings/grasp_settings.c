/*
 *  Copyright 2016 CNRS & Universite Lille 1. All rights reserved.
 *  
 *  Licensed under the GRASP Open Source License V1.0 (see LICENSE file)
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>
#include "grasp_settings.h"
#include "grasp_settings_data_types.h"
#include "yamlsettings/yamlsettings_validators.h"
#include "yamlsettings/yamlsettings_dictionary.h"
#include "yamlsettings/yamlsettings_data_types.h"
#include "yamlsettings/yamlsettings_assign_data.h"
#include "grasp_settings_assign_data.h"
#include "grasp_settings_validators.h"
#include "yamlsettings/yamlsettings.h"
#include "grasp_settings_data_types.h"
#include <grasp/utils.h>
#include "../global/grasp_compilation_information.h"
#include "../global/grasp_error_codes.h"
#include "../input/grasp_input_load_functions.h" // For loading input driver settings.
#include "../output/grasp_output_load_function.h"
#include "../output/grasp_output_stream.h"


#include <grasp/utils.h>


// definition of private functions used later
// This function wraps yamlsettings_copy_parameter from libyamlsettings library
// adding the functionaly to add classification block for extension settings.
typedef enum { GRASP_NO_EXTENSION, GRASP_EXTENSION_DRIVER, GRASP_EXTENSION_TRANSFORMER, GRASP_EXTENSION_SEGMENT_FUNCTION, GRASP_EXTENSION_CURRENT_FUNCTION, GRASP_EXTENSION_TILE_FUNCTION } grasp_settings_type_parameter;
void grasp_settings_copy_parameter(yamlsettings_parameter *origin, yamlsettings_parameter *dest, grasp_settings_type_parameter extension_type, const char *extension_name);

yamlsettings_dictionary_t *grasp_settings_dictionary_get(grasp_settings *settings){
    yamlsettings_default NLAYERS={ys_d_all,{"dummy"}};
    sprintf(NLAYERS.arguments[0],"%d",_KNT-1);

    // Static definition of a dictionary
    yamlsettings_parameter settings_global[]= {
         /*                 name                                                                                                                     , memory direction                               , counter memory direction              , func to set variable type (length of value)             , initial value                               ,  number of elements          , allow_array             , parameter description                                                                                                                                                                                                                                                                                                                ,                 validator 1                 ,                   validator 2                         ,                    validator 3                            , {input function, output function, assigned}   */
         {"help"                                                                                                                                     , &settings->settings.help                       , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Shows this help information"                                                                                                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"version"                                                                                                                                  , &settings->settings.version                    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Shows GRASP code version information and stops"                                                                                                                                                                                                                                                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"resources_path"                                                                                                                           , &settings->global.resources_path               , NULL                                  , YS_DATA_TYPE_FOLDER_PATH(_GBL_FILE_PATH_LEN)            , {ys_d_all,{RESOURCES_PREFIX                            }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path to framework resources folder"                                                                                                                                                                                                                                                                                                 , {                                            {yamlsettings_validator_directory  , {           }  }                                                             },YAMLSETTINGS_END_VAR  },
    };
    yamlsettings_parameter settings_retrieval[]= {
         {"retrieval.general.path_to_internal_files"                                                                                                 , &settings->retrieval.DLSF.internal_file_path   , NULL                                  , YS_DATA_TYPE_INTERNAL_FILES_PATH(_GBL_FILE_PATH_LEN)    , {ys_d_all,{DEFAULT_INTERNAL_FILES                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path to internal data files"                                                                                                                                                                                                                                                                                                        , {                                            {yamlsettings_validator_directory , {           }  }                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.mode"                                                                                                                           , &settings->retrieval.ISTOP                     , NULL                                  , GRASP_DATA_TYPE_RETRIEVAL_MODE                          , {ys_d_all,{"inversion"                                 }}, {0,{}}                       , YS_PARAM_SCALAR         , "Define how the code is run. Valid values 'inversion' or 'forward' (inversion=full inversion; forward=only forward model)"                                                                                                                                                                                                           , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                           
         {"retrieval.inversion.convergence.minimization_convention"                                                                                  , &settings->retrieval.KL                        , NULL                                  , GRASP_DATA_TYPE_MINIMIZATION                            , {ys_d_all,{"absolute"                                  }}, {0,{}}                       , YS_PARAM_SCALAR         , "Minimization in absolute or logarithm space"                                                                                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.threshold_for_stopping_Q_iterations"                                                                      , &settings->retrieval.EPSQ                      , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Threshold for stopping q - iterations: once the change in the residual smaller than this parameter the iterations are stopped"                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.scale_for_finite_difference"                                                                              , &settings->retrieval.DL                        , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Defines DL for calculations of derivatives: (f(x+DL)-f(x))/DL"                                                                                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.inversion.convergence.threshold_for_stopping"                                                                                   , &settings->retrieval.EPSP                      , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Threshold for stopping p - iterations: once the change in the residual smaller than this parameter the iterations stops"                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.normal_system_solver"                                                                                     , &settings->retrieval.IMQ                       , NULL                                  , GRASP_DATA_TYPE_IMQ                                     , {ys_d_all,{"singular_value_decomposition"              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Defines the method to solve normal system"                                                                                                                                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.maximum_iterations_of_Levenberg-Marquardt"                                                                , &settings->retrieval.IPSTOP                    , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The maximum number of ip iterations where Levenberg-Marquardt correction is applied"                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.minimum_value_of_Levenberg-Marquardt_term"                                                                , &settings->retrieval.LM_MIN                    , NULL                                  , YS_DATA_TYPE_FLOAT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The minimum value of Levenberg-Marquardt correction term is applied. Default value = 0"                                                                                                                                                                                                                                                , {                 {yamlsettings_validator_float,{"0e-0","1e-2"}}                                                                                          },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.minimum_value_of_residual_coefficient"                                                                    , &settings->retrieval.CCOR_MIN                  , NULL                                  , YS_DATA_TYPE_FLOAT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The minimum value of residual coefficient is applied. Default value = 0"                                                                                                                                                                                                                                                , {                                {yamlsettings_validator_float,{"0e-0","1e+1"}}                                                                                            },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.maximum_value_of_residual_coefficient"                                                                    , &settings->retrieval.CCOR_MAX                  , NULL                                  , YS_DATA_TYPE_FLOAT                                        , {ys_d_all,{"100"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The maximum value of residual coefficient is applied. Default value = 100"                                                                                                                                                                                                                                                , {                            {yamlsettings_validator_float,{"5e+1","2e+2"}}                                                                                            },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.maximum_iterations_for_stopping"                                                                          , &settings->retrieval.MAXP                      , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"99"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "Maximum number of iterations performed in the retrieval before stop"                                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.convergence.shift_for_applying_logarithm_to_negative_values"                                                          , &settings->retrieval.SHIFT                     , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"1.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "This value (usually 1) is added to negative parameters in order to be able to apply logarithmic transformations"                                                                                                                                                                                                                    , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"retrieval.inversion.regime"                                                                                                               , &settings->retrieval.IPFP.INVSING              , NULL                                  , GRASP_DATA_TYPE_INVSING                                 , {ys_d_all,{"single_pixel"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "'single-pixel': Retrieval is performed pixel by pixel; 'multi-pixel': Retrieval is performed for all pixels at once"                                                                                                                                                                                                                                                                                     , { {yamlsettings_validator_mandatory,{}}                                                   },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.independent_concentration_and_shape"                                                                                  , &settings->retrieval.indep_par                 , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "If true, SD and Vertical distribution is adapted to have n-1 elements to eliminate the correlation between the shape parameters and concentration"                                                                                                                                                                                 , {                                                                                                                                                               },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.measurement_fitting.polarization"                                                                                     , &settings->retrieval.iPOBS                     , NULL                                  , GRASP_DATA_TYPE_PFITTING                                , {ys_d_all,{"absolute_polarization_components"          }}, {0,{}}                       , YS_PARAM_SCALAR         , "Valid values: 'absolute_polarization_components': I, Q, U; 'relative_polarization_components': I, Q/I, U/I; 'polarized_reflectance': I, (Q^2+U^2)^(1/2) (Polarized measurements can be defined in input data as Q and U or P); 'degree_of_polarization': I, [(Q^2+U^2)^(1/2)]/I (Polarized measurements can be defined in input data as Q and U or P); 'relative_phase_matrix_meas': P/I (User has to provide P/I in input data)"                 , {                                                },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.measurement_fitting.scattering_angle_for_normalized_p11"                                                              , &settings->retrieval.sca_ang_norm_p11          , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"-180.0"                                    }}, {0,{}}                       , YS_PARAM_SCALAR         , "For P11 retrieval. If P11 is given as absolute value, this option has to be -180.0 (default value). If P11 is relative, indicate with this option the value of the angle that has to be used to divide all p11 values."                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.measurement_fitting.integrated_p11_measurements_cut_off"                                                              , &settings->retrieval.CUTOFF.rmax               , &settings->retrieval.CUTOFF.nrmax     , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.0"                                       }}, {1,{4}}                      , YS_PARAM_OPTIONAL_ARRAY  , "It indicates the PM cut-off for the P11 integrated measurements"                                                                                                                                                                                                                                                                   , {                                                                            {graspsettings_validator_cut_off,{}}                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.measurement_fitting.integrated_p11_measurements_cut_off_diff"                                                         , &settings->retrieval.CUTOFF.cutoff_meas_diff   , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "If true, for N>2 p11_integrated_cutoff_N measurements are calculated as p11_integrated_cutoff_N=p11_integrated_cutoff_N-sum(p11_integrated_cutoff_1:p11_integrated_cutoff_(N-1))"                                                                                                                                               , {                                                                                                                                                                  },YAMLSETTINGS_END_VAR  },

         {"retrieval.inversion.noises.add_random_noise"                                                                                              , &settings->retrieval.NOISE.meas_rnoise         , NULL                                  , GRASP_DATA_TYPE_RNOISE                                  , {ys_d_all,{"measurement_fitting"               }}, {0,{}}                   , YS_PARAM_SCALAR   , "Add random noise to measurements. Valid values: disable (standard_deviation_synthetic is ignored), measurement_fitting (random noise with standard_deviation_synthetic is added to the vector of fitted measurements but it is not added to the fitting), sdata (random noise with standard_deviation_synthetic is added to the fitting sdata measurements so one can get an sdata file with noise added retrieval.mode=forward). If retrieval.mode=inversion, random noise is added to the input sdata measurements.", {            /*{graspsettings_validator_rnoise ,{}}    */   },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.noises.noise[].standard_deviation_synthetic"                                                                          , &settings->retrieval.NOISE.SGMS                , &settings->tmp.NOISE_ISGMS            , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {1,{_KKNOISE}}               , YS_PARAM_SCALAR         , "Standard deviation of synthetic random noise added to the corresponding inverted data, if value is 0 no synthetic random noise is added"                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.noises.noise[].bias_measurements_synthetic"                                                                           , &settings->retrieval.NOISE.BIAS                , &settings->tmp.NOISE_BIAS             , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {1,{_KKNOISE}}               , YS_PARAM_SCALAR         , "Bias added to the synthetic measurements, if value is 0 no bias is added"                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.noises.noise[].bias_equation"                                                                                       , &settings->retrieval.NOISE.BIAS_EQ             , &settings->tmp.NOISE_BIAS_EQ          , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {1,{_KKNOISE}}               , YS_PARAM_SCALAR         , "Bias added to the systematic component of error, if value is 0 no bias is added"                                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },

         {"retrieval.inversion.noises.noise[].error_type"                                                                                            , &settings->retrieval.NOISE.INN                 , &settings->retrieval.NOISE.INOISE     , GRASP_DATA_TYPE_ERROR                                   , {ys_d_all,{"absolute"                                  }}, {1,{_KKNOISE}}               , YS_PARAM_SCALAR         , "Error type used for definition of covariance matrices used in measurement fitting and in modeling synthetic noise"                                                                                                                                                                                                                  , {                         {yamlsettings_validator_mandatory,{}}                                                                                                },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.noises.noise[].standard_deviation"                                                                                    , &settings->retrieval.NOISE.DNN                 , &settings->tmp.NOISE_IDNN             , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {1,{_KKNOISE}}               , YS_PARAM_SCALAR         , "Standard deviation of the random noise expected (this defines the covariance matrix used in fitting)"                                                                                                                                                                                                                               , {                         {yamlsettings_validator_mandatory,{}}                                                                                                },YAMLSETTINGS_END_VAR  },
         {"retrieval.inversion.noises.noise[].measurement_type[].type"                                                                               , &settings->retrieval.NOISE.MT                  , settings->retrieval.NOISE.NMT         , GRASP_DATA_TYPE_MEASURETYPES                            , {ys_d_all,{"tod"                                       }}, {2,{_KKNOISE,_KIP}}          , YS_PARAM_SCALAR         , "Type of relevant measurements for applying the noise assumptions"                                                                                                                                                                                                                                                                   , {                         {yamlsettings_validator_mandatory,{}}                                                                                                },YAMLSETTINGS_END_VAR  },         
         {"retrieval.inversion.noises.noise[].measurement_type[].index_of_wavelength_involved"                                                       , &settings->retrieval.NOISE.IWLP                , (int *)settings->retrieval.NOISE.NWLP , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {3,{_KKNOISE,_KIP,_KWM}}     , YS_PARAM_ARRAY          , "List of indices of relevant wavelengths for applying the noise assumptions"                                                                                                                                                                                                                                                         , {                          {yamlsettings_validator_mandatory,{}} ,                  {graspsettings_validator_indexes_of_wavelengths,{"1"}}                      },YAMLSETTINGS_END_VAR  },              
         {"retrieval.forward_model.phase_matrix.size_binning_method_for_triangle_bins"                                                               , &settings->retrieval.IBIN                      , NULL                                  , GRASP_DATA_TYPE_BIN                                     , {ys_d_all,{"logarithm"                                 }}, {0,{}}                       , YS_PARAM_SCALAR         , "Determining the scale used for the binning of size distribution"                                                                                                                                                                                                                                                                    , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.spectral_threshold_for_model_wavlengths"                                                             , &settings->retrieval.tiny_wvl_models           , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"1e-1"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Threshold value to determine if the wavelength present in sdata is the same as the one in the aerosol models"                                                                                                                                                                                                                       , {                           {yamlsettings_validator_float,{"1e-3","1e-1"}}                                                                                             },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.number_of_elements"                                                                                  , &settings->retrieval.DLSF.keyEL                , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of phase matrix elements used in the calculations and retrieval"                                                                                                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.kernels_interpolation_for_size_parameter"                                                            , &settings->retrieval.DLSF.keyLS                , NULL                                  , GRASP_DATA_TYPE_INTERPOLATION                           , {ys_d_all,{"linear"                                    }}, {0,{}}                       , YS_PARAM_SCALAR         , "Kernels interpolation for size parameter (linear or spline). Default value = linear."                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },

         {"retrieval.forward_model.phase_matrix.kernels_folder"                                                                                      , &settings->retrieval.DLSF.distname_O           , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"KERNELS_BASE/"                             }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path to kernels when we retrieve size distribution for triangle bins or lognormal size distribution"                                                                                                                                                                                                                                , {                                               {graspsettings_validator_kernelpath ,{}}                                                                       },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.radius.mode[].bins"                                                                                  , &settings->retrieval.RADIUS1                   , settings->retrieval.NBIN              , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {2,{_KSD,_KIDIM3}}           , YS_PARAM_ARRAY          , "Number of triangle bins set for size distribution representation"                                                                                                                                                                                                                                                                   , {                                {graspsettings_validator_bins,{}}                                                                                             },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.radius.mode[].min"                                                                                   , &settings->retrieval.RMIN                      , &settings->tmp.NRMIN                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"-1"                                        }}, {1,{_KSD}}                   , YS_PARAM_SCALAR         , "Minimum value of the radius used in the triangle bins"                                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.radius.mode[].max"                                                                                   , &settings->retrieval.RMAX                      , &settings->tmp.NRMAX                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"-1"                                        }}, {1,{_KSD}}                   , YS_PARAM_SCALAR         , "Maximum value of the radius used in the triangle bins"                                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.ratio.mode[].value"                                                                                  , &settings->retrieval.RATIO1                    , settings->tmp.NRATIO1                 , YS_DATA_TYPE_FLOAT                                      , {ys_d_array,{"0", "2", "0:1.0", "1:2.986"              }}, {2,{_KSD, _KIDIM3}}          , YS_PARAM_ARRAY          , "Values of bins using in retrieved aspect or axis distributions"                                                                                                                                                                                                                                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         
         {"retrieval.forward_model.phase_matrix.use_transport_model"                                                                                 , &settings->retrieval.use_tmodel                , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "If enabled the use of transport models is activated and the characteristic from the initial guess for each pixel will be loaded and processed"                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.transport_model.vertical_profile"                                                                    , &settings->retrieval.TMSET.flag_av_vprof       , NULL                                  , GRASP_DATA_TYPE_AER_TRM_VERTICAL_AVERAGE_TYPE           , {ys_d_all,{"column_average"                            }}, {0,{}}                       , YS_PARAM_SCALAR         , "Method for vertical profile average: column_average (default) or tracer_average"                                                                                                                                                                                                                                                    , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         
         {"retrieval.forward_model.phase_matrix.transport_model.tracers"                                                                             , &settings->retrieval.TMSET.trcs                , &settings->retrieval.TMSET.ntrc       , YS_DATA_TYPE_STRING(5)                                  , {ys_d_all,{"xx"                                        }}, {1,{_KIDIM2}}                , YS_PARAM_ARRAY         , "Tracer types to be used"                                                                                                                                                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.transport_model.density"                                                                             , &settings->retrieval.TMSET.density             , &settings->retrieval.TMSET.ntrc       , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.0"                                       }}, {1,{_KIDIM2}}                , YS_PARAM_ARRAY         , "Density values for given tracers in kg/m^3"                                                                                                                                                                                                                                                                                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.phase_matrix.transport_model.hydrophilic"                                                                         , &settings->retrieval.TMSET.flag_hphi           , &settings->tmp.TMPSET_nhyd            , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {1,{_KIDIM2}}                , YS_PARAM_ARRAY         , "Hydrophilic tracers, yes (1) or not(0)"                                                                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },

         {"retrieval.forward_model.phase_matrix.number_of_bins_for_lognormal_size_distribution"                                                       , &settings->retrieval.KNLN                        , &settings->retrieval.TMSET.ntrc       , YS_DATA_TYPE_INT                                        , {ys_d_all,{"22"                                         }}, {1,{_KSD}}                 , YS_PARAM_OPTIONAL_ARRAY , "Number of bins for lognormal size distribution."                                                                                                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },

         {"retrieval.forward_model.radiative_transfer.number_of_layers"                                                                              , &settings->retrieval.NLYRS                     , &settings->tmp.NNLYRS                 , YS_DATA_TYPE_INT                                        , NLAYERS                                                  , {1,{2}}                      , YS_PARAM_OPTIONAL_ARRAY , "Maximum number of optical vertical layers resolved in radiative transfer (minimum and maximum value. If only one number is assigned maximum is by default KNT-1)"                                                                                                                                                                   , {  {yamlsettings_validator_int_non_strict,{"0",CONST2STR(_KNT)}}        ,{yamlsettings_validator_ascendant_int_array,{}}                                       },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.number_of_geometrical_levels"                                                                  , &settings->retrieval.NLVLS_GEOM                , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"100"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of geometrical vertical levels for radiative transfer. Default value = 100"                                                                                                                                                                                                                                                 , {                         {yamlsettings_validator_int,{"50",CONST2STR(_KVERT_WD)}}                                                                             },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.molecular_profile_vertical_type"                                                               , &settings->retrieval.mol_prof_type             , NULL                                  , GRASP_DATA_TYPE_MOL_PROF_VERT_TYPE                      , {ys_d_all,{"exponential"                               }}, {0,{}}                       , YS_PARAM_SCALAR         , "It defines which model will be used to describe vertical profile of molecular (Rayleigh) scattering. Values: 'Exponential' describes molecular density profile at altitude h as exp(h/8)/8, 'Standard_atmosphere' uses standard atmosphere model (pressure and temperature profiles) to calculate molecular density at each altitude." , {                                                                                                                                                           },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.aerosol_profile_vertical_type"                                                                 , &settings->retrieval.aer_prof_type             , NULL                                  , GRASP_DATA_TYPE_AER_PROF_VERT_TYPE                      , {ys_d_all,{"gaussian"                                  }}, {0,{}}                       , YS_PARAM_SCALAR         , "It defines which model will be used to describe vertical profile of aerosol distribution. Values: 'Exponential' describes aerosol concentration profile at altitude h as exp(h/HM)/HM, 'gaussian' uses normal distribution exp(h-HM)/(sqrt(rpi)*sqrt(2.)*sigma) with sigma and HM parameter taken from characteristics, 'threshold' sets a uniform profile that is not zero only below HM."            , {                                                                                           },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.phase_matrix_truncation"                                                                       , &settings->retrieval.ITRONC                    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Switch on/off the truncation: the technique to calculate scattering effects from the sharp forward peak of the phase function separately from those of the rest of the phase function. It doesn't effect considerably the accuracy while provides much faster calculations"                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"retrieval.forward_model.radiative_transfer.absolute_error_rt_calculations"                                                                , &settings->retrieval.eps_err                   , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.0001"                                    }}, {0,{}}                       , YS_PARAM_SCALAR         , "Absolute value of truncation threshold of Fourier and order-of-scattering series expansions in radiative transfer calculations"                                                                                                                                                                                                     , {                                           {yamlsettings_validator_float,{"1e-6","1e-3"}}                                                                     },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.reference_plane_for_polarization"                                                              , &settings->retrieval.ipplane                   , NULL                                  , GRASP_DATA_TYPE_IPPLANE                                 , {ys_d_all,{"principal_plane"                           }}, {0,{}}                       , YS_PARAM_SCALAR         , "Reference plane for polarization calculations"                                                                                                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.BOA_reflectance"                                                                               , &settings->retrieval.BOA_REF                   , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Perform atmospheric correction calculation of surface reflectance and surface BRDF at the Bottom-Of-Atmosphere"                                                                                                                                                                                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"retrieval.forward_model.radiative_transfer.rt_kernels.mode"                                                                               , &settings->retrieval.IMODE_LUT                 , NULL                                 , GRASP_DATA_TYPE_IMODE_LUT                               , {ys_d_all,{"disable"                                   }}, {0,{}}                       , YS_PARAM_SCALAR         , "LUT Mode for radiative transfer (disable by default)"                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.rt_kernels.folder"                                                                             , &settings->retrieval.LUT_path                  , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"./"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "Folder for aerosol look-up-table"                                                                                                                                                                                                                                                                                                   , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.simulating_observation.order_of_scattering"                                                    , &settings->retrieval.OSHF.IMSC                 , NULL                                  , GRASP_DATA_TYPE_OSHF_IMSC                               , {ys_d_all,{"multiple_scattering"                       }}, {0,{}}                       , YS_PARAM_SCALAR         , "Regime of scattering used for modeling diffuse radiation observations"                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.simulating_observation.number_of_gaussian_quadratures_for_expansion_coefficients"              , &settings->retrieval.OSHF.NG                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Gaussian quadratures for calculating expansion coefficients used for multiple scattering simulations"                                                                                                                                                                                                                     , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NG0)}}                                                                 },YAMLSETTINGS_END_VAR  },     
         {"retrieval.forward_model.radiative_transfer.simulating_observation.number_of_guassian_quadratures_for_fourier_expansion_coefficients"      , &settings->retrieval.OSHF.NN                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Gaussian quadratures for calculating Fourier expansion coefficients used for multiple scattering simulations"                                                                                                                                                                                                             , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NN0)}}                                                                 },YAMLSETTINGS_END_VAR  },     
         {"retrieval.forward_model.radiative_transfer.simulating_observation.number_of_fourier_expansion_coefficients"                               , &settings->retrieval.OSHF.NF                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Fourier expansion coefficients used in multiple scattering simulations"                                                                                                                                                                                                                                                   , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NN0)}}                                                                 },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.radiative_transfer.simulating_derivatives.order_of_scattering"                                                    , &settings->retrieval.OSHD.IMSC                 , NULL                                  , GRASP_DATA_TYPE_OSHD_IMSC                               , {ys_d_all,{"single_scattering"                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Regime of scattering used in calculation of radiance derivatives"                                                                                                                                                                                                                                                                   , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },     
         {"retrieval.forward_model.radiative_transfer.simulating_derivatives.number_of_gaussian_quadratures_for_expansion_coefficients"              , &settings->retrieval.OSHD.NG                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Gaussian quadratures for calculating expansion coefficients used in calculation of radiance derivatives"                                                                                                                                                                                                                  , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NG0)}}                                                                 },YAMLSETTINGS_END_VAR  },     
         {"retrieval.forward_model.radiative_transfer.simulating_derivatives.number_of_guassian_quadratures_for_fourier_expansion_coefficients"      , &settings->retrieval.OSHD.NN                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Gaussian quadratures used for calculating Fourier expansion coefficients used in calculation of radiance derivatives"                                                                                                                                                                                                     , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NN0)}}                                                                 },YAMLSETTINGS_END_VAR  },     
         {"retrieval.forward_model.radiative_transfer.simulating_derivatives.number_of_fourier_expansion_coefficients"                               , &settings->retrieval.OSHD.NF                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of Fourier expansion coefficients used in calculation of radiance derivatives"                                                                                                                                                                                                                                               , {                                           {yamlsettings_validator_int,{"0",CONST2STR(_NN0)}}                                                                 },YAMLSETTINGS_END_VAR  },        
         {"retrieval.forward_model.atmospheric_vertical_profile.source"                                                                              , &settings->retrieval.atmospheric_vertical_profile.stdat   , NULL                       , GRASP_DATA_TYPE_STDAT_NAME                              , {ys_d_all,{"us_standard"                               }}, {0,{}}                       , YS_PARAM_SCALAR         , "It defines what kind of standard atmosphere vertical profile will be used to interpolate extinction gas profiles from look-up-table. From a provided profile: from_file; or from a standard atmosphere:  US: US Standard, MS: Mid latitude Summer, MW: Mid latitude Winter, SS: Subarctic Summer, SW: Subarctic Winter, TR: TRopical atmosphere."                                                       , {                                                                                          },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.atmospheric_vertical_profile.file"                                                                                , &settings->retrieval.atmospheric_vertical_profile.vtp     , NULL                       , YS_DATA_TYPE_FILE_PATH(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "File containing atmospheric pressure and temperature vertical profile."                                                                                                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.integration_method"                                                                                    , &settings->retrieval.gases.integration_method  , NULL                                  , GRASP_DATA_TYPE_INT_METHOD                              , {ys_d_all,{"no"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "It defines what kind of integration approach will be used to simulate the radiance of each channel, or line-by-line method (LBL) or k-distribution (KDIST) methods. If 'no-absorption' values is provided, gas absorption is not accounted (default)"                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.forward_model.absorption.k-distribution_file"                                                                                   , &settings->retrieval.gases.kdist               , NULL                                  , YS_DATA_TYPE_FILE_PATH(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "File containing all information related to k-distribution methodology."                                                                                                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.luts_folder"                                                                                           , &settings->retrieval.gases.path_to_luts        , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path relative to internal_files/ where all look-up-table files can be found."                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.luts.lut[].file"                                                                                       , &settings->retrieval.gases.lut_name            , &settings->retrieval.gases.nlut_name  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {1,{_NMG}}                   , YS_PARAM_SCALAR         , "Complete name of the look-up-table file"                                                                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.luts.lut[].spectral_ranges.min"                                                                        , &settings->retrieval.gases.spectral_ranges_min , settings->retrieval.gases.ngases_spectral_range  , YS_DATA_TYPE_FLOAT                           , {ys_d_all,{"0.0"                                       }}, {2,{_NMG,_NG_SPEC_RANGE_MAX}}, YS_PARAM_OPTIONAL_ARRAY , "Different spectral intervals in microns where the considered gaseous species absorption is going to be taken into account. Minimum value of each range"                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.luts.lut[].spectral_ranges.max"                                                                        , &settings->retrieval.gases.spectral_ranges_max , settings->tmp.ngases_spectral_range  , YS_DATA_TYPE_FLOAT                                       , {ys_d_all,{"0.0"                                       }}, {2,{_NMG,_NG_SPEC_RANGE_MAX}}, YS_PARAM_OPTIONAL_ARRAY , "Different spectral intervals in microns where the considered gaseous species absorption is going to be taken into account. Maximum value of each range"                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.channels.filter[].measurement_type"                                                                    , &settings->retrieval.gases.filters_meas_type   , &settings->retrieval.gases.ngas_filters, GRASP_DATA_TYPE_MEASURETYPES                           , {ys_d_all,{"LS"                                        }}, {1,{_N_FILTERS_MAX}}         , YS_PARAM_SCALAR         , "Measurement type which corresponds to the considered filter."                                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.channels.filter[].index_of_wavelength_involved"                                                        , &settings->retrieval.gases.filters_index_of_wavelength_involved, (int *)settings->retrieval.gases.nfilters_index_of_wavelength_involved , YS_DATA_TYPE_INT , {ys_d_all,{"1"                               }}, {2,{_N_FILTERS_MAX,_KW}}     , YS_PARAM_ARRAY          , "List of indices of relevant wavelengths for applying the noise assumptions."                                                                                                                                                                                                                                                        , {{graspsettings_validator_all_wavelengths_defined,{}}, {graspsettings_validator_indexes_of_wavelengths,{"1"}},{graspsettings_validator_int_not_repeated_or_one,{}} },YAMLSETTINGS_END_VAR  },  
         {"retrieval.forward_model.absorption.channels.filter[].spectral_resolution"                                                                 , &settings->retrieval.gases.filters_spectral_resolution, &settings->tmp.nfilters_spectral_resolution, YS_DATA_TYPE_FLOAT                          , {ys_d_all,{"0.0"                                       }}, {1,{_KW}}                    , YS_PARAM_SCALAR         , "Full half-maximum width  of the considered filter."                                                                                                                                                                                                                                                                                 , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.channels.filter[].file"                                                                                , &settings->retrieval.gases.filters_file        , (int *)settings->tmp.nfilters_path_to_filters, YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)          , {ys_d_all,{"."                                         }}, {2,{_N_FILTERS_MAX,_KW}}     , YS_PARAM_OPTIONAL_ARRAY , "Filter information with all the considered wavelengths in microns and their corresponding transmitances."                                                                                                                                                                                                                  		   , {                																															                    },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.channels.filter[].number_of_subchannels"                                                               , &settings->retrieval.gases.nsubchannels        , &settings->tmp.nsubchannels           , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{_KW}}                    , YS_PARAM_SCALAR         , "Number of subchannels in which the main channel will be linearly divided."                                                                                                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.absorption.channels.filters_folder"                                                                               , &settings->retrieval.gases.path_to_filters     , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path relative to internal_files/ where the filter files are stored."                                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.forward_model.emission.planck_function"                                                                                         , &settings->retrieval.emission.planck           , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Take into account Planck emission of atmosphere and surface or not in radiative transfer."                                                                                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.emission.solar_irradiance_contribution"                                                                           , &settings->retrieval.emission.solar_irradiance , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Take into account Solar emission in thermal infrared spectral range or not in radiative transfer. This only works in retrieval.forward_model.emission.planck_function is TRUE"                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.emission.threshold_wavelength_for_accounting_TIR"                                                                 , &settings->retrieval.emission.threshold_for_starting_wavelength , NULL                 , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"2.5"                                       }}, {0,{}}                       , YS_PARAM_SCALAR         , "Wavelength in um which marks the minimum channels to take into account Planck emission in radiative transfer."                                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.emission.folder"                                                                                                  , &settings->retrieval.emission.folder           , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path relative to internal_files/ to  kernels or precalculated refractive indexes for aerosol in TIR."                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.aerosol.chemistry.folder"                                                                                         , &settings->retrieval.chemistry.folder          , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path relative to internal_files/ where all information of chemical refractive indexes can be found."                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                           
	       {"retrieval.forward_model.aerosol.chemistry.soluble"                                                                                        , &settings->retrieval.chemistry.soluble         , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"ammnm_ntrt"                                }}, {0,{}}                       , YS_PARAM_SCALAR         , "Soluble chemical specie taken into account to form host in case of Maxwell-Garnett aerosol mixing."                                                                                                                                                                                                                                 , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.forward_model.aerosol.chemistry.species.mode[]"                                                                                 , &settings->retrieval.chemistry.species         , (int *)settings->tmp.nspecies         , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {2,{_KSD,_N_CHEM_MAX}}       , YS_PARAM_OPTIONAL_ARRAY , "Name of the different chemical species considered for each mode."                                                                                                                                                                                                                                                                   , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.products.configuration.wavelength_indices_for_angstrom"                                                                         , &settings->retrieval.Aexp_iwl                  , &settings->tmp.nAexp_iwl              , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{2}}                      , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to calculate Angstrom exponent"                                                                                                                                                                                                                                                           , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.configuration.aerosol_particulate_matter_diameter"                                                                     , &settings->retrieval.PM_diam                   , &settings->retrieval.nPM_diam         , YS_DATA_TYPE_FLOAT                                      , {ys_d_array,{"0"  ,"2","0:2.5","1:10"                  }}, {1,{2}}                      , YS_PARAM_OPTIONAL_ARRAY , "Diameters of aerosol particles in microns which will be used to calculate Particulate Matter (PM)"                                                                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.configuration.wavelength_indices_for_ndvi"                                                                             , &settings->retrieval.ndvi_iwl                  , &settings->tmp.nndvi_iwl              , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{2}}                      , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to calculate NDVI if it is calculated"                                                                                                                                                                                                                                                    , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.configuration.wavelenght_indices_for_aod_error_estimation"                                                             , &settings->retrieval.aod_errest_iwl            , &settings->retrieval.naod_errest_iwl  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{_KW}}                    , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to estimate aod error"                                                                                                                                                                                                                                                                    , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.configuration.wavelenght_indices_for_ssa_error_estimation"                                                             , &settings->retrieval.ssa_errest_iwl            , &settings->retrieval.nssa_errest_iwl  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{_KW}}                    , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to estimate ssa error"                                                                                                                                                                                                                                                                    , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
        {"retrieval.products.configuration.wavelenght_indices_for_aext_error_estimation"                                                             , &settings->retrieval.aext_errest_iwl            , &settings->retrieval.naext_errest_iwl  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{_KW}}                    , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to estimate aext error"                                                                                                                                                                                                                                                                    , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
        {"retrieval.products.configuration.wavelenght_indices_for_lidar_error_estimation"                                                           , &settings->retrieval.lidar_errest_iwl          , &settings->retrieval.nlidar_errest_iwl, YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {1,{_KW}}                    , YS_PARAM_ARRAY          , "Indices of wavelengths which will be used to estimate lidar error"                                                                                                                                                                                                                                                                  , {                                          {graspsettings_validator_indexes_of_wavelengths,{"1"}} , {yamlsettings_validator_ascendant_int_array,{}}            },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.chemistry"                                                                                                     , &settings->retrieval.products.aerosol.chem     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Retrieve aerosol chemical composition (if retrieved)"                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.lidar"                                                                                                         , &settings->retrieval.products.aerosol.lidar    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Retrieve columnar lidar ratios (e.g., if lidar data are inverted)"                                                                                                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.optical_properties"                                                                                            , &settings->retrieval.products.aerosol.opt      , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide aerosol optical properties"                                                                                                                                                                                                                                                                                                 , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.phase_matrix"                                                                                                  , &settings->retrieval.products.aerosol.phmx     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Obtain aerosol phase matrix"                                                                                                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.refractive_index"                                                                                              , &settings->retrieval.products.aerosol.rind     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide aerosol refractive index"                                                                                                                                                                                                                                                                                                   , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.theoretical_bimodal_extinction"                                                                                , &settings->retrieval.products.aerosol.sd2m_ext , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide estimated aerosol extinction for fine and coarse modes"                                                                                                                                                                                                                                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.theoretical_bimodal_parameters"                                                                                , &settings->retrieval.products.aerosol.sd2m_mph , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide estimated aerosol microphysical characteristics for fine and coarse modes"                                                                                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.particulate_matter"                                                                                            , &settings->retrieval.products.aerosol.pm       , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Obtain aerosol particulate matter estimation at given particle diameters"                                                                                                                                                                                                                                                           , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.aerosol.type"                                                                                                          , &settings->retrieval.products.aerosol.types    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Obtain aerosol type index i.e. 0-Complex mixture,1-Background,2-Maritime,3-Urbn.Polluted,4-Mixed,5-Urbn.clean,6-Smoke flam.,7-Smoke. sold.,8-Dust"                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.gases.concentration"                                                                                                   , &settings->retrieval.products.gases.concentration, NULL                                , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Retrieve gas concentration products (true/false)"                                                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.gases.absorption"                                                                                                      , &settings->retrieval.products.gases.absorption , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Retrieve gas absoption products (true/false)"                                                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.error_estimation.aerosol.lidar"                                                                                        , &settings->retrieval.products.errest.aerosol.lidar, NULL                               , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Implement error estimation for aerosol lidar products"                                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.error_estimation.aerosol.optical_properties"                                                                           , &settings->retrieval.products.errest.aerosol.opt  , NULL                               , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Implement error estimation for optical properties of aerosol products"                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.error_estimation.aerosol.microphysical_properties"                                                                                 , &settings->retrieval.products.errest.aerosol.mic  , NULL                               , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Implement error estimation for microphysical properties of aerosol products (particularly sd error when it is not part of the retrieved parameters)"                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.error_estimation.parameters"                                                                                           , &settings->retrieval.products.errest.par          , NULL                               , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Implement error estimation for retrieved parameters"                                                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                                                                                                                                                                            
         {"retrieval.products.forcing.broadband_flux"                                                                                                , &settings->retrieval.products.forcing.bbflux   , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide upward and downward fluxes integrated over the solar spectrum at the user-defined levels for the scenarios with and without aerosols"                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.forcing.forcing"                                                                                                       , &settings->retrieval.products.forcing.forcing  , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide aerosol radiative forcing values at the user-defined levels"                                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                                                                                                                                                                                           
         {"retrieval.products.retrieval.fitting"                                                                                                     , &settings->retrieval.products.retrieval.fit    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide obtained measurement fitting"                                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.retrieval.parameters"                                                                                                  , &settings->retrieval.products.retrieval.par    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide retrieved parameters"                                                                                                                                                                                                                                                                                                       , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.retrieval.residual"                                                                                                    , &settings->retrieval.products.retrieval.res    , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide values of obtained residuals"                                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.products.surface.main_characteristics"                                                                                          , &settings->retrieval.products.surface.surf     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide surface reflectance products"                                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.products.surface.isotropic_bihemispherical_reflectance"                                                                         , &settings->retrieval.products.surface.bhr_iso  , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Provide white sky albedo calculation"                                                                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.edges_size.x"                                                                                                                   , &settings->retrieval.edges.nx                  , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of edges width in pixels (it have to be lower than KIEDGE compilation constant)"                                                                                                                                                                                                                                               , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIEDGE)}}                                                                                                       },YAMLSETTINGS_END_VAR  },
         {"retrieval.edges_size.y"                                                                                                                   , &settings->retrieval.edges.ny                  , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of edges height in pixels (it have to be lower than KIEDGE compilation constant)"                                                                                                                                                                                                                                              , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIEDGE)}}                                                                                                       },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.edges_size.t"                                                                                                                   , &settings->retrieval.edges.nt                  , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of temporal dimension of edges (it have to be lower than KIEDGE compilation constant)"                                                                                                                                                                                                                                         , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIEDGE)}}                                                                                                       },YAMLSETTINGS_END_VAR  },     
         {"retrieval.debug.verbose"                                                                                                                  , &settings->retrieval.IPRI_verbose              , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Retrieval prints progress information while it is performing the inversion"                                                                                                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.debug.additional_information"                                                                                                   , &settings->retrieval.IPRI_additional_info      , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Print some additional information"                                                                                                                                                                                                                                                                                                  , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         //{"retrieval.debug.simulated_sdata_file"                                                                                                     , &settings->retrieval.sdata_sim_file            , NULL                                  , YS_DATA_TYPE_FILE_PATH(_GBL_FILE_PATH_LEN)              , {ys_d_all,{""                                          }}, {0,{}}                       , YS_PARAM_SCALAR         , "Filename where simulated observation data are to be printed. This option force retrieval.general.mode=forward"                                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                                  
         {"retrieval.debug.path_to_extra_files"                                                                                                      , &settings->retrieval.DLSF.external_file_path   , NULL                                  , YS_DATA_TYPE_FOLDER_PATH(_GBL_FILE_PATH_LEN)            , {ys_d_all,{"/tmp/"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Path to folder with retrieval extra files: debug information, extra resources like image.dat files..."                                                                                                                                                                                                                              , {                                            {yamlsettings_validator_directory , {           }  }                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.debug.use_internal_initial_guess"                                                                                               , &settings->retrieval.INPUT                     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Test option which allows to load different initial guess for each pixel (loading them from image.dat files)"                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.debug.covariance_matrix"                                                                                                        , &settings->retrieval.debug_covariance_matrix   , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "If true the covariance matrix will be printed in new file in the current directry with the name test_cov_matrix.txt"                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"retrieval.debug.error_estimates_using_Levenberg-Marquardt"                                                                                , &settings->retrieval.debug_errest_lm           , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Default true. If Levenberg-Marquardt is taken into account for the error estimation"                                                                                                                                                                                                                                                , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },

         {"retrieval.constraints.multi_pixel_smoothness_T_difference_threshold"                                                                 , &settings->retrieval.MPCS.time_diff_threshold_sec   , NULL                             , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                      , YS_PARAM_SCALAR         , "Value of time difference threshold in seconds for time smoothness constraints in multi-pixel retrieval regime"                                                                                                                                                                                                                   , {                                           {yamlsettings_validator_float,{"0e+0","21600e+0"}}                                                                                                                     },YAMLSETTINGS_END_VAR  },

         {"retrieval.constraints.characteristic[].type"                                                                                              , &settings->retrieval.NDIM.par_type             , &settings->tmp.NDIM_npar_type         , GRASP_DATA_TYPE_CHARACTERISTIC                          , {ys_d_all,{"size_distribution_triangle_bins"           }}, {1,{_KIDIM1}}                , YS_PARAM_SCALAR         , "Type of characteristic"                                                                                                                                                                                                                                                                                                             , {  {yamlsettings_validator_mandatory,{}} , {graspsettings_validator_characteristic_type,{}}                                                                    },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].retrieved"                                                                                         , &settings->retrieval.NDIM.par_retr             , &settings->tmp.NDIM_npar_retr         , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {1,{_KIDIM1}}                , YS_PARAM_SCALAR         , "Specify if this characteristic will be retrieved or only used in forward model"                                                                                                                                                                                                                                                     , {                                         {graspsettings_validator_characteristic_retrieved,{}}                                                                },YAMLSETTINGS_END_VAR  },
//         {"retrieval.constraints.characteristic[].mode[].approach.method"                                                                            , &settings->retrieval.FRETR.method              , settings->tmp.RERT_nmethod            , GRASP_DATA_TYPE_FRETR_METHOD_TYPE                       , {ys_d_all,{"full_set"                                  }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Method of the retrieval approach for this characteristic. full_set is the default value but it can be 'subset' or 'coefficients'"                                                                                                                                                                                                   , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
//         {"retrieval.constraints.characteristic[].mode[].approach.function"                                                                          , &settings->retrieval.FRETR.function            , settings->tmp.RERT_nfunction          , GRASP_DATA_TYPE_FRETR_FUNCTION_TYPE                     , {ys_d_all,{"constant"                                  }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Function to be applied in the functional approach: constant (default) or linear_logarithmic"                                                                                                                                                                                                                                        , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
//         {"retrieval.constraints.characteristic[].mode[].approach.index_of_wavelength_involved"                                                      , &settings->retrieval.FRETR.ipar                , (int *)settings->retrieval.FRETR.nn   , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {3,{_KIDIM1,_KIDIM2,_KIDIM3}}, YS_PARAM_OPTIONAL_ARRAY , "Index to be used in the functional retrieval approach"                                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].initial_guess.value"                                                                        , &settings->tmp.TAPSING                         , (int *)settings->tmp.NTAPSING         , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{CONST2STR(FLT_MIN)                          }}, {3,{_KIDIM1,_KIDIM2,_KPARS}} , YS_PARAM_OPTIONAL_ARRAY , "Initial values for a specific (determined by type) characteristic"                                                                                                                                                                                                                                                                  , {  {yamlsettings_validator_float,{CONST2STR(FLT_MIN),CONST2STR(INFINITE)}}                                                                                     },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].initial_guess.min"                                                                          , &settings->tmp.TAPSMIN                         , (int *)settings->tmp.NTAPSMIN         , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {3,{_KIDIM1,_KIDIM2,_KPARS}} , YS_PARAM_OPTIONAL_ARRAY , "Minimum value for the specific characteristic"                                                                                                                                                                                                                                                                                      , {  {yamlsettings_validator_same_nelements,{"retrieval.constraints.characteristic[].mode[].initial_guess.value"}}                                               },YAMLSETTINGS_END_VAR  },        
         {"retrieval.constraints.characteristic[].mode[].initial_guess.max"                                                                          , &settings->tmp.TAPSMAX                         , (int *)settings->tmp.NTAPSMAX         , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {3,{_KIDIM1,_KIDIM2,_KPARS}} , YS_PARAM_OPTIONAL_ARRAY , "Maximum value for the specific characteristic"                                                                                                                                                                                                                                                                                      , {  {yamlsettings_validator_same_nelements,{"retrieval.constraints.characteristic[].mode[].initial_guess.value"}}                                               },YAMLSETTINGS_END_VAR  },        
         {"retrieval.constraints.characteristic[].mode[].initial_guess.index_of_wavelength_involved"                                                 , &settings->tmp.TIWW_SINGL                      , (int *)settings->tmp.NTIWW_SINGL      , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {3,{_KIDIM1,_KIDIM2,_KPARS}} , YS_PARAM_OPTIONAL_ARRAY , "Indices of Wavelengths associated to the specific characteristic"                                                                                                                                                                                                                                                                   , { {yamlsettings_validator_mandatory,{}}, {yamlsettings_validator_same_nelements,{"retrieval.constraints.characteristic[].mode[].initial_guess.value"}},{graspsettings_validator_indexes_of_wavelengths,{"0"}}},YAMLSETTINGS_END_VAR  },        
         {"retrieval.constraints.characteristic[].mode[].initial_guess.estimate_error"                                                               , &settings->tmp.TAPSERREST                      , (int *)settings->tmp.NTAPSERREST      , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {3,{_KIDIM1,_KIDIM2,_KPARS}} , YS_PARAM_OPTIONAL_ARRAY , "Flag to retrieve the error of specific parameter if retrieval.products.error_estimation.parameters is true"                                                                                                                                                                                                                         , { {yamlsettings_validator_same_nelements,{"retrieval.constraints.characteristic[].mode[].initial_guess.value"}},                                               },YAMLSETTINGS_END_VAR  },        
         {"retrieval.constraints.characteristic[].mode[].single_pixel.a_priori_estimates.lagrange_multiplier"                                        , &settings->retrieval.SPCA.GSM                  , (int *)settings->tmp.SPCA_IGSM        , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {3,{_KIDIM1,_KIDIM2,_KIDIM3}}, YS_PARAM_ARRAY          , "Value of the Lagrange multiplier associated to a priori estimate of the retrieved characteristics (applied in each single pixel)"                                                                                                                                                                                                   , {  {graspsettings_validator_same_nelements_or_zero,{"retrieval.constraints.characteristic[].mode[].initial_guess.value"}}                                      },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].single_pixel.smoothness_constraints.difference_order"                                       , &settings->retrieval.SPCS.IO                   , settings->tmp.SPCS_IIO                , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Order of the derivatives/differences  used for applying a priori smoothness constrains for the retrieved characteristics"                                                                                                                                                                                                           , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].single_pixel.smoothness_constraints.lagrange_multiplier"                                    , &settings->retrieval.SPCS.GSM                  , settings->tmp.SPCS_IGSM               , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Value of the Lagrange multiplayer used for applying a priori smoothness constraints for the retrieved characteristics"                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].single_pixel.smoothness_constraints.estimates"                                              , &settings->retrieval.SMS.EST                   , (int *)settings->tmp.SMS_IEST         , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {3,{_KIDIM1,_KIDIM2,_KIDIM3}}, YS_PARAM_ARRAY          , "Estimate value of the smoothness costraint"                                                                                                                                                                                                                                                                                         , {                                    {graspsettings_validator_estimates_and_weights , {           }  }                                                         },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].single_pixel.smoothness_constraints.weights"                                                , &settings->retrieval.SMS.WGT                   , (int *)settings->tmp.SMS_IWGT         , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"1.000000e+00"                              }}, {3,{_KIDIM1,_KIDIM2,_KIDIM3}}, YS_PARAM_ARRAY          , "Weight of the smoothness constraint"                                                                                                                                                                                                                                                                                                , {                                    {graspsettings_validator_estimates_and_weights  , {           }  }                                                        },YAMLSETTINGS_END_VAR  },         
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.derivative_order_of_X_variability"                       , &settings->retrieval.MPCS.IOX                  , settings->tmp.MPCS_IIOX               , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Order of derivatives/differences  used for applying a priori smoothness constraints on parameter inter-pixel X-variability in multi-pixel retrieval regime"                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.lagrange_multiplier_of_X_variability"                    , &settings->retrieval.MPCS.GSMX                 , settings->tmp.MPCS_IGSMX              , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Value of the Lagrange multiplier used for applying a priori smoothness constraints on parameter inter-pixel X-variability in multi-pixel retrieval regime"                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },               
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.derivative_order_of_Y_variability"                       , &settings->retrieval.MPCS.IOY                  , settings->tmp.MPCS_IIOY               , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Order of derivatives/differences  used for applying a priori smoothness constraints on parameter inter-pixel Y-variability in multi-pixel retrieval regime"                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.lagrange_multiplier_of_Y_variability"                    , &settings->retrieval.MPCS.GSMY                 , settings->tmp.MPCS_IGSMY              , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Value of the Lagrange multiplier used for applying a priori smoothness constraints on parameter inter-pixel Y-variability in multi-pixel retrieval regime"                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.derivative_order_of_T_variability"                       , &settings->retrieval.MPCS.IOT                  , settings->tmp.MPCS_IIOT               , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Order of derivatives/differences  used for applying a priori smoothness constraints on parameter inter-pixel T-variability in multi-pixel retrieval regime"                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"retrieval.constraints.characteristic[].mode[].multi_pixel.smoothness_constraints.lagrange_multiplier_of_T_variability"                    , &settings->retrieval.MPCS.GSMT                 , settings->tmp.MPCS_IGSMT              , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {2,{_KIDIM1,_KIDIM2}}        , YS_PARAM_SCALAR         , "Value of the Lagrange multiplier used for applying a priori smoothness constraints on parameter inter-pixel T-variability in multi-pixel retrieval regime"                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                   
    };
        
    yamlsettings_parameter settings_settings[]= {
         {"settings.debug"                                                                                                                           , &settings->settings.debug                      , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"."                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Shows settings read to run this program"                                                                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"settings.strict"                                                                                                                          , &settings->settings.strict                     , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Force GRASP to continue when there were parse or validation errors in the settings file"                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"settings.dump"                                                                                                                            , &settings->settings.short_dump                 , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to dump read settings in short format(experimental)"                                                                                                                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"settings.long_dump"                                                                                                                       , &settings->settings.long_dump                  , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to dump read settings in long format (experimental)"                                                                                                                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
    };
    yamlsettings_parameter settings_input[]= {
         {"input.driver"                                                                                                                             , &settings->input.driver_name                   , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"sdata_driver"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "The driver that will be called for inverting data"                                                                                                                                                                                                                                                                                  , {  {yamlsettings_validator_mandatory,{}}           , {grasp_settings_validator_input_driver,{}}                                                                },YAMLSETTINGS_END_VAR  },
         {"input.file"                                                                                                                               , &settings->input.files                         , &settings->input.nfiles               , YS_DATA_TYPE_FILE_PATH(_GBL_FILE_PATH_LEN)              , {ys_d_all,{""                                          }}, {1,{GRASP_INPUT_MAX_FILES}}  , YS_PARAM_OPTIONAL_ARRAY , "Name of file(s) which contain input observation"                                                                                                                                                                                                                                                                                    , {  {yamlsettings_validator_mandatory,{}}                                                                                                                       },YAMLSETTINGS_END_VAR  },
         {"input.center.latitude"                                                                                                                    , &settings->input.coordinates.lat               , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Latitude of the center of tile to invert"                                                                                                                                                                                                                                                                                           , {  {yamlsettings_validator_float ,{"-90.0","90.0"}}                                                                                                            },YAMLSETTINGS_END_VAR  },
         {"input.center.longitude"                                                                                                                   , &settings->input.coordinates.lon               , NULL                                  , YS_DATA_TYPE_FLOAT                                      , {ys_d_all,{"0.000000e+00"                              }}, {0,{}}                       , YS_PARAM_SCALAR         , "Latitude of the center of tile to invert"                                                                                                                                                                                                                                                                                           , {  {yamlsettings_validator_float ,{"-180.0","180.0"}}                                                                                                          },YAMLSETTINGS_END_VAR  },
         {"input.corner.row"                                                                                                                         , &settings->input.coordinates_grid.row          , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"-1"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "The number of the row for input driver in the native coordinate system of the sensor"                                                                                                                                                                                                                                               , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"input.corner.column"                                                                                                                      , &settings->input.coordinates_grid.col          , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"-1"                                        }}, {0,{}}                       , YS_PARAM_SCALAR         , "The number of the column for input driver in the native coordinate system of the sensor"                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"input.grid_offset.row"                                                                                                                    , &settings->input.grid_offset.row               , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Information of the first row in the input grid that will be use for normalizing the output. If 0 is used the output coordinate reference will be the same than the input. This offset is for forcing the output row to start at 0 (e.g. if you put 1, output_row == input_row - 1)"                                                 , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"input.grid_offset.column"                                                                                                                 , &settings->input.grid_offset.col               , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Information of the first column in the input grid that will be used for normalizing the output. If 0 is used the output coordinate reference will be the same than the input. This offset is for forcing the output column to start at 0 (e.g. if you put 1, output_column == input_column - 1)"                                    , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"input.area.width"                                                                                                                         , &settings->input.area_width                    , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The width of the covered area in pixels. It has to be divisible by intput.segment.x value"                                                                                                                                                                                                                                          , {              {graspsettings_validator_divisible,{"input.segment.x"}}                                                                                         },YAMLSETTINGS_END_VAR  },
         {"input.area.height"                                                                                                                        , &settings->input.area_height                   , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "The height of the covered area in pixels. It has to be divisible by intput.segment.y value"                                                                                                                                                                                                                                         , {              {graspsettings_validator_divisible,{"input.segment.y"}}                                                                                         },YAMLSETTINGS_END_VAR  },
         {"input.time.from"                                                                                                                          , &settings->input.time_from                     , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{""                                          }}, {0,{}}                       , YS_PARAM_SCALAR         , "Initial date and time for data processing (format: YYYY-MM-DDThh:mm:ssZ)"                                                                                                                                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },
         {"input.time.to"                                                                                                                            , &settings->input.time_to                       , NULL                                  , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{""                                          }}, {0,{}}                       , YS_PARAM_SCALAR         , "Final date and time for data processing (format: YYYY-MM-DDThh:mm:ssZ)"                                                                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"input.segment.x"                                                                                                                          , &settings->input.segment_nx                    , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{CONST2STR(_KIX)                             }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of segment width in pixels (it have to be lower than KIX compilation constant)"                                                                                                                                                                                                                                                , {  {yamlsettings_validator_int,{"1",CONST2STR(_KIX)}}                                                                                                          },YAMLSETTINGS_END_VAR  },
         {"input.segment.y"                                                                                                                          , &settings->input.segment_ny                    , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{CONST2STR(_KIY)                             }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of segment height in pixels (it have to be lower than KIY compilation constant)"                                                                                                                                                                                                                                               , {  {yamlsettings_validator_int,{"1",CONST2STR(_KIY)}}                                                                                                          },YAMLSETTINGS_END_VAR  },                  
         {"input.segment.t"                                                                                                                          , &settings->input.segment_nt                    , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{CONST2STR(_KITIME)                          }}, {0,{}}                       , YS_PARAM_SCALAR         , "Size of segment temporal dimension (it have to be lower than KITIME compilation constant)"                                                                                                                                                                                                                                          , {  {yamlsettings_validator_int,{"1",CONST2STR(_KITIME)}}                                                                                                       },YAMLSETTINGS_END_VAR  },                  
         {"input.transformer"                                                                                                                        , &settings->input.transformers_name             , &settings->input.ntransformers        , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)                 , {ys_d_all,{"none"                                      }}, {1,{GRASP_INPUT_MAX_TRANSFORMERS}}, YS_PARAM_OPTIONAL_ARRAY, "Name of input data transformer functions to be used after load data"                                                                                                                                                                                                                                                            , {                                                  {grasp_settings_validator_input_transformer,{}}                                                             },YAMLSETTINGS_END_VAR  },        
         {"input.debug.raw_segment"                                                                                                                  , &settings->input.print_raw_segment             , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to print raw segment data loaded"                                                                                                                                                                                                                                                                                            , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"input.debug.clean_segment"                                                                                                                , &settings->input.print_clean_segment           , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to print segment information after clean NaN values"                                                                                                                                                                                                                                                                         , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"input.debug.used_files"                                                                                                                   , &settings->input.print_used_files              , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to print names of the files that have the pixels for inverting"                                                                                                                                                                                                                                                              , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                  
         {"input.debug.sdata_dump_after_driver"                                                                                                      , &settings->input.sdata_dump_after_driver       , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where to dump sdata information just after being generated by the driver. Some transformers can modify sdata information, this setting is thought for debugging purposes where the user is interested in knowing sdata generated by the driver instead of data driving inside the inversion."                                , {                                            {grasp_settings_validator_stream   , {           }  }                                                             },YAMLSETTINGS_END_VAR  },         
         {"input.debug.sdata_dump_after_transformer"                                                                                                 , &settings->input.sdata_dump_after_transformer  , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where to dump sdata information just after being modified by the trasformer. This is the input file that goes to GRASP Fortran code"                                                                                                                                                                                         , {                                            {grasp_settings_validator_stream   , {           }  }                                                             },YAMLSETTINGS_END_VAR  },         
         {"input.sdata.dump"                                                                                                                         , &settings->input.sdata_stream                  , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where to dump sdata information"                                                                                                                                                                                                                                                                                             , {                                            {grasp_settings_validator_stream   , {           }  }                                                             },YAMLSETTINGS_END_VAR  },         
         {"input.imagedat.dump"                                                                                                                      , &settings->input.imagedat_stream               , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where to dump initial guess information (image.dat format)"                                                                                                                                                                                                                                                                  , {                                            {grasp_settings_validator_stream   , {           }  }                                                             },YAMLSETTINGS_END_VAR  },         
         {"input.preload_segment.x"                                                                                                                  , &settings->input.preload_nsegmentx             , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "This parameter specifies how many segments in X dimension will be preloaded in each block"                                                                                                                                                                                                                                          , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIX)}}                                                                                                          },YAMLSETTINGS_END_VAR  },
         {"input.preload_segment.y"                                                                                                                  , &settings->input.preload_nsegmenty             , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "This parameter specifies how many segments in Y dimension will be preloaded in each block"                                                                                                                                                                                                                                          , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIX)}}                                                                                                          },YAMLSETTINGS_END_VAR  },
         {"input.preload_segment.t"                                                                                                                  , &settings->input.preload_nsegmentt             , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "This parameter specifies how many segments in T dimension will be preloaded in each block"                                                                                                                                                                                                                                          , {  {yamlsettings_validator_int,{"0",CONST2STR(_KIX)}}                                                                                                          },YAMLSETTINGS_END_VAR  },
    };
    yamlsettings_parameter settings_output[]= {
         {"output.segment.function"                                                                                                                  , &settings->output.segment_output_function      , &settings->output.nsegment_output_function, YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)             , {ys_d_all,{"classic"                                   }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Driver to process output for every single retrieval (show information in screen, perform a map, plotting, ...)"                                                                                                                                                                                                                     , {                                                  {grasp_settings_validator_output_segment_function,{}}                                                       },YAMLSETTINGS_END_VAR  },
         {"output.segment.stream"                                                                                                                    , &settings->output.segment_stream               , &settings->output.nsegment_stream         , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)          , {ys_d_all,{"screen"                                    }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Stream to dump segment output data"                                                                                                                                                                                                                                                                                                 , {                                                  {grasp_settings_validator_stream  , {           }  }  ,                                                     },YAMLSETTINGS_END_VAR  },         
         {"output.iteration.function"                                                                                                                , &settings->output.iteration_output_function    , &settings->output.niteration_output_function, YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)           , {ys_d_all,{"none"                                      }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Driver to process output for every single retrieval (show information in screen, perform a map, plotting, ...)"                                                                                                                                                                                                                     , {                                                  {grasp_settings_validator_output_segment_function,{}}                                                       },YAMLSETTINGS_END_VAR  },
         {"output.iteration.stream"                                                                                                                  , &settings->output.iteration_stream             , &settings->output.niteration_stream         , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)        , {ys_d_all,{"screen"                                    }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Stream to dump segment output data"                                                                                                                                                                                                                                                                                                 , {                                                  {grasp_settings_validator_stream  , {           }  }  ,                                                     },YAMLSETTINGS_END_VAR  },         
         {"output.tile.function"                                                                                                                     , &settings->output.tile_output_function         , &settings->output.ntile_output_function   , YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)             , {ys_d_all,{"none"                                      }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Driver to process output after processing complete tile (show information in screen, perform a map, plotting, ...)"                                                                                                                                                                                                                 , {                                                  {grasp_settings_validator_output_tile_function,{}}                                                          },YAMLSETTINGS_END_VAR  },                  
         {"output.tile.stream"                                                                                                                       , &settings->output.tile_stream                  , &settings->output.ntile_stream            , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)          , {ys_d_all,{"screen"                                    }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Stream to dump tile output data"                                                                                                                                                                                                                                                                                                    , {                                                  {grasp_settings_validator_stream  , {           }  }                                                        },YAMLSETTINGS_END_VAR  },         
         {"output.current.function"                                                                                                                  , &settings->output.current_output_function      , &settings->output.ncurrent_output_function, YS_DATA_TYPE_STRING(_GBL_FILE_PATH_LEN)             , {ys_d_all,{"none"                                      }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Driver to process output after each retrieval (show information in screen, perform a map, plotting, ...)"                                                                                                                                                                                                                           , {                                                  {grasp_settings_validator_output_current_function,{}}                                                       },YAMLSETTINGS_END_VAR  },
         {"output.current.stream"                                                                                                                    , &settings->output.current_stream               , &settings->output.ncurrent_stream         , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)          , {ys_d_all,{"screen"                                    }}, {1,{GRASP_MAX_OUTPUT_FUNC}}  , YS_PARAM_OPTIONAL_ARRAY , "Stream to dump current progress information about the retrieval conducted"                                                                                                                                                                                                                                                          , {                                                  {grasp_settings_validator_stream  , {           }  }  ,                                                     },YAMLSETTINGS_END_VAR  },         
         {"output.sdata.dump"                                                                                                                        , &settings->output.simulated_file               , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where to dump sdata fitting information. Fitting product has to be enabled, otherwise this is ignored. Fitting is dumped after retrieval process."                                                                                                                                                                           , {    {grasp_settings_validator_stream   , {           }  } ,   {grasp_settings_validator_simulated_file  , {           }  }  ,                                 },YAMLSETTINGS_END_VAR  },         
    };
    yamlsettings_parameter settings_controller[]= {
         {"controller.segment_range"                                                                                                                 , &settings->controller.segment_range            , &settings->controller.nsegment_range  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"-1"                                        }}, {1,{2}}                      , YS_PARAM_OPTIONAL_ARRAY , "This parameter allows specifying a range of segments that will be inverted/processed. If it is a single number a specific retrieval will be processed. Use -1 as undefined. For example [15, -1] will process all retrievals starting by the segment #15"                                                                           , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"controller.debug.perform_retrieval"                                                                                                       , &settings->controller.perform_retrieval        , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"true"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Allowing controller to call retrieval. If this parameter is false the framework will work without inverting the data and it will force to use only none output functions (results will not be printed). This parameter is useful for debug the framework or prepare input data"                                                     , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },                                     
         {"controller.debug.compilation_information"                                                                                                 , &settings->controller.compilation_information  , NULL                                  , YS_DATA_TYPE_BOOLEAN                                    , {ys_d_all,{"false"                                     }}, {0,{}}                       , YS_PARAM_SCALAR         , "Print compilation information at the beginning of the process"                                                                                                                                                                                                                                                                      , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"controller.debug.tracking_memory_stream"                                                                                                  , &settings->controller.track_mem_stream         , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"none"                                      }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream where printing all information about memory allocated during the execution (debugging information)"                                                                                                                                                                                                                          , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"controller.stream"                                                                                                                        , &settings->controller.stream_pattern           , NULL                                  , GRASP_DATA_TYPE_STREAM(_GBL_FILE_PATH_LEN)              , {ys_d_all,{"screen"                                    }}, {0,{}}                       , YS_PARAM_SCALAR         , "Stream to dump controller information"                                                                                                                                                                                                                                                                                              , {                                            {grasp_settings_validator_stream  , {           }  }                                                              },YAMLSETTINGS_END_VAR  },                  
         {"controller.mpi.maximum_job_time"                                                                                                          , &settings->controller.maximum_job_time         , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"0"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Maximum number of seconds that the master node will wait for a working node for obtaining results. After this time (specified in seconds) if the job is not finished the controller will kill the task and the segment will be skipped"                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
         {"controller.mpi.polling_time"                                                                                                              , &settings->controller.polling_time             , NULL                                  , YS_DATA_TYPE_INT                                        , {ys_d_all,{"1"                                         }}, {0,{}}                       , YS_PARAM_SCALAR         , "Number of seconds that the master node wait after checking the workers"                                                                                                                                                                                                                                                             , {                                                                                                                                                              },YAMLSETTINGS_END_VAR  },         
    }; 
    
   int i,c,idriver, ifunction, itransformer; 
   // Dinamic definition of a dictionary
   yamlsettings_dictionary_t *dictionary;
   // Dictionary for input drivers
   grasp_settings_parameter_array **driver_parameters;
   grasp_settings_parameter_array **transformer_parameters;
   grasp_settings_parameter_array **segment_function_parameters;
   grasp_settings_parameter_array **tile_function_parameters;
   grasp_settings_parameter_array **current_function_parameters;
   
   driver_parameters=grasp_input_driver_get_settings_parameters(settings);
   transformer_parameters=grasp_input_transformer_get_settings_parameters(settings);
   segment_function_parameters=grasp_output_segment_functions_get_settings_parameters(settings);
   tile_function_parameters=grasp_output_tile_functions_get_settings_parameters(settings);
   current_function_parameters=grasp_output_current_functions_get_settings_parameters(settings);
              
   // Create a dictionary and return it
   dictionary=(yamlsettings_dictionary_t *)trackmem_malloc(sizeof(yamlsettings_dictionary_t));   
   assert(dictionary!=NULL);
   
   dictionary->nparameters=
           sizeof(settings_global)/sizeof(yamlsettings_parameter) +
           sizeof(settings_retrieval)/sizeof(yamlsettings_parameter) +
           sizeof(settings_settings)/sizeof(yamlsettings_parameter) +
           sizeof(settings_input)/sizeof(yamlsettings_parameter) +
           sizeof(settings_output)/sizeof(yamlsettings_parameter) +
           sizeof(settings_controller)/sizeof(yamlsettings_parameter) 
           ;
   
   // Calculating input drivers number of parameters
   for (idriver = 0; idriver < grasp_input_ndrivers(); idriver++) {
       if(driver_parameters[idriver]!=NULL){
           dictionary->nparameters+=driver_parameters[idriver]->nparameters;
       }
    }
   // for transformers
   for (itransformer = 0; itransformer < grasp_input_ntransformers(); itransformer++) {
       if(transformer_parameters[itransformer]!=NULL){
           dictionary->nparameters+=transformer_parameters[itransformer]->nparameters;
       }
    }
   
    // Calculating segment function parameters
    for (ifunction = 0; ifunction < grasp_output_segment_nfunctions(); ifunction++) {
        if(segment_function_parameters[ifunction]!=NULL){
            dictionary->nparameters+=segment_function_parameters[ifunction]->nparameters;
        }
    }   
    // Calculating tile function parameters
    for (ifunction = 0; ifunction < grasp_output_tile_nfunctions(); ifunction++) {
        if(tile_function_parameters[ifunction]!=NULL){
            dictionary->nparameters+=tile_function_parameters[ifunction]->nparameters;
        }
    }
    // Calculating current function parameters
    for (ifunction = 0; ifunction < grasp_output_current_nfunctions(); ifunction++) {
        if(current_function_parameters[ifunction]!=NULL){
            dictionary->nparameters+=current_function_parameters[ifunction]->nparameters;
        }
    }   
   
   dictionary->settings=settings;
   dictionary->parameters=(yamlsettings_parameter *)trackmem_malloc(sizeof(yamlsettings_parameter)*(dictionary->nparameters));
   assert(dictionary->parameters!=NULL);
   
   // Copying parameters
   c=0;
   for(i=c;i<sizeof(settings_global)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_global[i-c]),&(dictionary->parameters[i]));
   }
   c=i;
   for(i=c;i<sizeof(settings_retrieval)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_retrieval[i-c]),&(dictionary->parameters[i]));
   } 
   c=i;
   for(i=c;i<sizeof(settings_settings)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_settings[i-c]),&(dictionary->parameters[i]));
   } 
   c=i;
   for(i=c;i<sizeof(settings_input)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_input[i-c]),&(dictionary->parameters[i]));
   } 
   // Copying parameters for input drivers
    for (idriver = 0; idriver < grasp_input_ndrivers(); idriver++) {
       if(driver_parameters[idriver]!=NULL){
           c=i;
           for(i=c;i<driver_parameters[idriver]->nparameters+c;i++){
                grasp_settings_copy_parameter(&(driver_parameters[idriver]->parameters[i-c]),&(dictionary->parameters[i]),GRASP_EXTENSION_DRIVER,grasp_input_driver_get_name(idriver));
           } 
           grasp_settings_parameter_array_destroy(driver_parameters[idriver]);
       }
    }   
   trackmem_free(driver_parameters);
   // For transformers
    for (itransformer = 0; itransformer < grasp_input_ntransformers(); itransformer++) {
       if(transformer_parameters[itransformer]!=NULL){
           c=i;
           for(i=c;i<transformer_parameters[itransformer]->nparameters+c;i++){
                grasp_settings_copy_parameter(&(transformer_parameters[itransformer]->parameters[i-c]),&(dictionary->parameters[i]),GRASP_EXTENSION_TRANSFORMER,grasp_input_transformer_get_name(itransformer));
           } 
           grasp_settings_parameter_array_destroy(transformer_parameters[itransformer]);
       }
    }   
   trackmem_free(transformer_parameters);
   
   c=i;
   for(i=c;i<sizeof(settings_output)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_output[i-c]),&(dictionary->parameters[i]));
   } 
   // Copying parameters for segment functions 
    for (ifunction = 0; ifunction < grasp_output_segment_nfunctions(); ifunction++) {
       if(segment_function_parameters[ifunction]!=NULL){
           c=i;
           for(i=c;i<segment_function_parameters[ifunction]->nparameters+c;i++){
                grasp_settings_copy_parameter(&(segment_function_parameters[ifunction]->parameters[i-c]),&(dictionary->parameters[i]), GRASP_EXTENSION_SEGMENT_FUNCTION,grasp_output_segment_function_get_name(ifunction));
           } 
           grasp_settings_parameter_array_destroy(segment_function_parameters[ifunction]);
       }
    }   
   trackmem_free(segment_function_parameters);
   c=i;
   // Copying parameters for tile functions 
    for (ifunction = 0; ifunction < grasp_output_tile_nfunctions(); ifunction++) {
       if(tile_function_parameters[ifunction]!=NULL){
           c=i;
           for(i=c;i<tile_function_parameters[ifunction]->nparameters+c;i++){
               grasp_settings_copy_parameter(&(tile_function_parameters[ifunction]->parameters[i-c]),&(dictionary->parameters[i]), GRASP_EXTENSION_TILE_FUNCTION,grasp_output_tile_function_get_name(ifunction));
           } 
           grasp_settings_parameter_array_destroy(tile_function_parameters[ifunction]);
       }
    }   
   trackmem_free(tile_function_parameters);
   c=i;
   // Copying parameters for current functions 
    for (ifunction = 0; ifunction < grasp_output_current_nfunctions(); ifunction++) {
       if(current_function_parameters[ifunction]!=NULL){
           c=i;
           for(i=c;i<current_function_parameters[ifunction]->nparameters+c;i++){
               grasp_settings_copy_parameter(&(current_function_parameters[ifunction]->parameters[i-c]),&(dictionary->parameters[i]), GRASP_EXTENSION_CURRENT_FUNCTION,grasp_output_current_function_get_name(ifunction));
           } 
           grasp_settings_parameter_array_destroy(current_function_parameters[ifunction]);
       }
    }   
   trackmem_free(current_function_parameters);
   c=i;
   
   for(i=c;i<sizeof(settings_controller)/sizeof(yamlsettings_parameter)+c;i++){
       yamlsettings_copy_parameter(&(settings_controller[i-c]),&(dictionary->parameters[i]));
   } 
   
   return dictionary;
}

void grasp_settings_postprocess_function(yamlsettings_dictionary_t *dictionary){
    grasp_settings_set_deducted_nwl(dictionary);
    grasp_settings_calculate_ndim_part(dictionary);
    grasp_settings_single_pixel_smoothness_constraints(dictionary);
    grasp_settings_calculate_iwl_and_key(dictionary); 
    grasp_settings_input_method(dictionary);
//    grasp_settings_simulated_sdata(dictionary);
    grasp_settings_controller_perform_retrieval(dictionary);
    grasp_settings_default_arrays_from_one_to_max_wl(dictionary);
}

int grasp_settings_to_yaml_string(char content[], grasp_settings *settings, bool print_defaults, bool force_arrays){
    yamlsettings_dictionary_t *dictionary; 
    
    yamlsettings_dictionary_t *reference_dictionary; 
    grasp_settings reference_settings;
    

    // Get dictionary for allocated settings
    dictionary=grasp_settings_dictionary_get(settings);

    reference_dictionary=grasp_settings_dictionary_get(&reference_settings);
    yamlsettings_initialize_dictionary(reference_dictionary,"none",YS_PARSE_SETTINGS_INLINE);
    yamlsettings_initialize_dictionary(dictionary,"none",YS_PARSE_SETTINGS_INLINE); 
    yamlsettings_dictionary_set_defaults(reference_dictionary);        

    strcpy(content, "# File generated by yamlsettings library\n# This functionality is experimental yet\n\n");
    yamlsettings_dump(content, dictionary, print_defaults, reference_dictionary, force_arrays);
    
   return 0;
}

int grasp_settings_description_json(char *json, int json_length){
    int status;
    yamlsettings_dictionary_t *dictionary;
    grasp_settings *settings;
    
    // Create a dictionary for retrive help information
    settings=(grasp_settings *)malloc(sizeof(grasp_settings));
    assert( settings!= NULL);
    dictionary=grasp_settings_dictionary_get(settings);
    yamlsettings_initialize_dictionary(dictionary, "",YS_PARSE_SETTINGS_INLINE);
    
    status=yamlsettings_dictionary_description_json(dictionary, json,  json_length);
    
    // Deallocate dictioanry
    yamlsettings_dictionary_complete_destroy(dictionary);
   
   return status;
}


/**
 * Function which dumps grasp settings in yaml format
 * @param stream_pattern Patter to initialize grasp_output_stream
 * @param settings Current settings you want to dump
 * @param print_defaults if you want to print default values or you prefer a reduced settings file based on only set information
 * @return 0 if everything was ok, otherwise a value different than 0
 */
int grasp_settings_dump(char *stream_pattern, grasp_settings *settings, bool print_defaults, bool force_arrays){
    grasp_output_stream tmp_stream;
    FILE *f;
    yamlsettings_dictionary_t *dictionary; 
    
    yamlsettings_dictionary_t *reference_dictionary; 
    grasp_settings reference_settings;
    char *content;
    
    
    // Dump short settings if stream is defined
    grasp_output_stream_initialize(stream_pattern, &tmp_stream);
    f=grasp_output_stream_open(&tmp_stream, settings, NULL, NULL, NULL, -1, -1, -1);
    if(grasp_output_stream_writable(&tmp_stream)==true){ // If it is not writable, close stream and finish function
        // Get dictionary for allocated settings
        dictionary=grasp_settings_dictionary_get(settings);
        
        reference_dictionary=grasp_settings_dictionary_get(&reference_settings);
        yamlsettings_initialize_dictionary(reference_dictionary,"none",YS_PARSE_SETTINGS_INLINE);
        yamlsettings_initialize_dictionary(dictionary,"none",YS_PARSE_SETTINGS_INLINE); 
        yamlsettings_dictionary_set_defaults(reference_dictionary);        

        content = (char *) malloc(sizeof (char)*10485760); //10MB
        strcpy(content, "# File generated by yamlsettings library\n# This functionality is experimental yet\n\n");
        yamlsettings_dump(content, dictionary, print_defaults, reference_dictionary, force_arrays);
        fprintf(f,"%s",content);
        free(content);
        
        yamlsettings_dictionary_destroy(dictionary);
        yamlsettings_dictionary_destroy(reference_dictionary);
    }  
    grasp_output_stream_close(&tmp_stream);
    grasp_output_stream_destroy(&tmp_stream);   
    
   return 0;
}

int grasp_settings_read(grasp_output_stream *controller_stream, yamlsettings_dictionary_t **dictionary, int nparameters, char const *parameters[], yamlsettings_parser_settings_file_mode settings_file_mode){
    int i, errors;
    grasp_settings *settings;
    
    // Allocate settings
    settings=(grasp_settings *)trackmem_malloc(sizeof(grasp_settings));
    memset(settings, 0, sizeof(grasp_settings));
    assert(settings!=NULL);

    // Get dictionary for allocated settings
    *dictionary=grasp_settings_dictionary_get(settings);

    // Read file
    errors=yamlsettings_read_file(*dictionary, nparameters,parameters, NULL, grasp_settings_postprocess_function, settings_file_mode); 

    // Initialize controller stream
    grasp_output_stream_initialize(((grasp_settings *)((*dictionary)->settings))->controller.stream_pattern, controller_stream);
    grasp_output_stream_open(controller_stream, NULL, NULL, NULL, NULL, -1, -1, -1);
    
    // If help argument is in list of arguments, even if there are problems we will print help and finish 
    if(strcmp(((grasp_settings *)((*dictionary)->settings))->settings.help,".")!=0){
        grasp_settings_help(controller_stream, ((grasp_settings *)((*dictionary)->settings))->settings.help);
        grasp_output_stream_destroy(controller_stream);
        yamlsettings_dictionary_complete_destroy(*dictionary);
        return GRASP_ERROR_SETTING_READ_HELP;
    }    
    
    // If version argument is in list of arguments, even if there are problems we will print version information and finish 
    if(((grasp_settings *)((*dictionary)->settings))->settings.version){
        grasp_version_print(stdout);
        grasp_output_stream_destroy(controller_stream);
        yamlsettings_dictionary_complete_destroy(*dictionary);
        return GRASP_ERROR_SETTINGS_PRINT_VERSION;
    }        

    // But if there was no help argument we will print errors and continue
    if(yamlsettings_error_number_parse_error(&(*dictionary)->status, YS_FATAL_ERROR)>0){
        for (i = 0; i < (*dictionary)->status.parse_errors->len; i++) {
            if(((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->type==YS_FATAL_ERROR){
                gos_fprintf(controller_stream, "ERROR: %s\n", ((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->message );
            }
        }   
        grasp_output_stream_destroy(controller_stream);
        yamlsettings_dictionary_complete_destroy(*dictionary);
        return GRASP_ERROR_SETTINGS_READ;
    }
    
    // If settings.debug is set we print debug information
    if (strcmp(((grasp_settings *)((*dictionary)->settings))->settings.debug,".")!=0) {
        yamlsettings_debug_dictionary(controller_stream->file,
                *dictionary,
                ((grasp_settings *)((*dictionary)->settings))->settings.debug);
        grasp_output_stream_destroy(controller_stream);
        yamlsettings_dictionary_complete_destroy(*dictionary);  
        return GRASP_ERROR_SETTINGS_PRINT_DEBUG;
    }    

    // Print parse errors
    for (i = 0; i < (*dictionary)->status.parse_errors->len; i++) {
        if(((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->type==YS_ERROR){
            gos_fprintf(controller_stream, "ERROR: ");
        }else if(((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->type==YS_FATAL_ERROR){
            gos_fprintf(controller_stream, "ERROR: ");
        }else if(((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->type==YS_WARNING){
            gos_fprintf(controller_stream, "WARNING: ");
        }else if(((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->type==YS_INFO){
            gos_fprintf(controller_stream, "INFO: ");
        }
        gos_fprintf(controller_stream, "%s\n", ((yamlsettings_parse_error *)((*dictionary)->status.parse_errors->pdata[i]))->message );
    }

    // Print validator erros if there are not parse errors
    for (i = 0; i < (*dictionary)->status.validation_errors->len; i++) {
        gos_fprintf(controller_stream, "ERROR: %s\n", ((yamlsettings_validation_error *)((*dictionary)->status.validation_errors->pdata[i]))->message );
    }   

    // Print error summary
    if((yamlsettings_error_number_parse_error(&(*dictionary)->status, YS_ERROR) + yamlsettings_error_number_parse_error(&(*dictionary)->status, YS_WARNING) + yamlsettings_error_number_validation_error(&(*dictionary)->status) )>0){
        gos_fprintf(controller_stream, "Summarizing settings problems: %d parse warnings, %d parse errors, %d validation errors\n", 
                yamlsettings_error_number_parse_error(&(*dictionary)->status, YS_WARNING), 
                yamlsettings_error_number_parse_error(&(*dictionary)->status, YS_ERROR), 
                yamlsettings_error_number_validation_error(&(*dictionary)->status));
        
        if(((grasp_settings *)((*dictionary)->settings))->settings.strict){
            gos_fprintf(controller_stream, "If you want to force to continue the execution, set settings.strict to false\n");
            grasp_output_stream_destroy(controller_stream);
            yamlsettings_dictionary_complete_destroy(*dictionary);
            return GRASP_ERROR_SETTINGS_READ;
        }else{
            gos_fprintf(controller_stream, "The execution will continue because settings.strict is false\n");
            errors = 0;
        }
    }
    
    // Dump short settings if stream is defined
    grasp_settings_dump(settings->settings.short_dump, settings, false, false);
    grasp_settings_dump(settings->settings.long_dump, settings, true, false);   
    
    return -errors; 
}

void grasp_settings_help(grasp_output_stream *controller_stream, const char *filter){
    yamlsettings_dictionary_t *dictionary;
    grasp_settings *settings;
    
    // Create a dictionary for retrive help information
    settings=(grasp_settings *)trackmem_malloc(sizeof(grasp_settings));
    assert( settings!= NULL);
    dictionary=grasp_settings_dictionary_get(settings);
    yamlsettings_initialize_dictionary(dictionary, "",YS_PARSE_SETTINGS_INLINE);
       
    if(grasp_output_stream_writable(controller_stream)==false){
        fprintf(stderr, "ERROR: Help information can not be printed if controller output stream is not writable");
        abort();
    }
    yamlsettings_print_help_information(controller_stream->file, dictionary, filter);
    
    // Deallocate dictioanry
    yamlsettings_dictionary_complete_destroy(dictionary);
}

char *grasp_settings_list_paths(){
    int i;
    yamlsettings_dictionary_t *dictionary;
    grasp_settings *settings;
    int size=0;
    char *result;
    
    // Create a dictionary for retrive help information
    settings=(grasp_settings *)trackmem_malloc(sizeof(grasp_settings));
    assert( settings!= NULL);
    dictionary=grasp_settings_dictionary_get(settings);
    yamlsettings_initialize_dictionary(dictionary, "",YS_PARSE_SETTINGS_INLINE);
       
    // Loop to calculate the size, second time the result is allocated and the string is concatenated
    for (i=0; i<dictionary->nparameters; i++){ 
        if(dictionary->parameters[i].data_type_set==yamlsettings_data_type_file_path_set ||
           dictionary->parameters[i].data_type_set==yamlsettings_data_type_folder_path_set ||
           dictionary->parameters[i].data_type_set==grasp_data_type_fortran_file_path_set ||
           dictionary->parameters[i].data_type_set==grasp_data_type_fortran_folder_path_set)
        {
            size+=strlen(dictionary->parameters[i].name)+1;  
        }
    }
    
    result=(char *)malloc((sizeof(char)*size)+5);
    strcpy(result,"");

    for (i=0; i<dictionary->nparameters; i++){ 
        if(dictionary->parameters[i].data_type_set==yamlsettings_data_type_file_path_set ||
           dictionary->parameters[i].data_type_set==yamlsettings_data_type_folder_path_set ||
           dictionary->parameters[i].data_type_set==grasp_data_type_fortran_file_path_set ||
           dictionary->parameters[i].data_type_set==grasp_data_type_fortran_folder_path_set)
        {
            strcat(result,dictionary->parameters[i].name);
            strcat(result,";");
        }
    }
    
    // Deallocate dictioanry
    yamlsettings_dictionary_complete_destroy(dictionary);
    
    return result;
}

char *grasp_settings_to_string(const char *filename){
    char *result;
    char *content;
    
    content=content_of_file(filename);
    
    result=(char *)trackmem_malloc(sizeof(char)*(strlen(content)+strlen(filename)+10));
    assert(result!=NULL);
    
    strcpy(result,"!");
    strcat(result,filename);
    strcat(result,";");
    strcat(result,content);
    
    free(content);
    
    return result;        
}

void grasp_settings_destroy(grasp_settings *settings){    
    trackmem_free(settings);
}

grasp_settings_parameter_array *grasp_settings_parameter_array_allocate(int nelements){
    grasp_settings_parameter_array *result;
    
    result = (grasp_settings_parameter_array *) trackmem_malloc(sizeof (grasp_settings_parameter_array));
    assert( result!= NULL);
    
    result->nparameters=nelements;
    
    result->parameters = (yamlsettings_parameter *) trackmem_malloc(sizeof (yamlsettings_parameter)*result->nparameters);    
    assert( result->parameters!= NULL);
    
    return result;
}


void grasp_settings_parameter_array_destroy(grasp_settings_parameter_array *x){    
    trackmem_free(x->parameters);    
    trackmem_free(x);
}


// PRIVATE FUCNTION
// This function wraps yamlsettings_copy_parameter from libyamlsettings library
// adding the functionaly to add classification block for extension settings.
void grasp_settings_copy_parameter(yamlsettings_parameter *origin, yamlsettings_parameter *dest, grasp_settings_type_parameter extension_type, const char *extension_name){
    char *tmp;
    
    // We use libyamlsettings function to copy all fields
    yamlsettings_copy_parameter(origin,dest);
    
    // But then, we customize the way to copy name
    if(extension_type!=GRASP_NO_EXTENSION){
        tmp = (char *) malloc(sizeof (char)* (50+strlen(origin->name)+strlen(extension_name)));
    }  
    
    switch (extension_type){
        case GRASP_NO_EXTENSION:
            break;
        case GRASP_EXTENSION_DRIVER:
            strcpy(tmp,"input.driver_settings.");  
            break;
        case GRASP_EXTENSION_TRANSFORMER:
            strcpy(tmp,"input.transformer_settings.");  
            break;
        case GRASP_EXTENSION_SEGMENT_FUNCTION:
            strcpy(tmp,"output.segment.function_settings.");  
            break;
        case GRASP_EXTENSION_CURRENT_FUNCTION:
            strcpy(tmp,"output.current.function_settings.");  
            break;
        case GRASP_EXTENSION_TILE_FUNCTION:
            strcpy(tmp,"output.tile.function_settings.");  
            break;
        default:
            fprintf(stderr, "%s:%d: ERROR: Unknown value of extension_type argument (value: %d)\n", __FILE__, __LINE__, extension_type);
            abort();
    }
    
    if(extension_type!=GRASP_NO_EXTENSION){
        strcat(tmp,extension_name);
        strcat(tmp,".");
        strcat(tmp,origin->name);
        dest->name=tmp;
        dest->name_deallocatable=true;  
    }
}



int grasp_settings_deduct_nwl(yamlsettings_dictionary_t *dictionary){
    grasp_settings *settings;
    settings=(grasp_settings *)dictionary->settings; 
    int i,j,k,max;
    
    max=-1;
    for (i = 0; i < _KKNOISE; i++) {
        for (j = 0; j < _KIP; j++) {
            for (k = 0; k < _KWM; k++) {
                if(settings->retrieval.NOISE.IWLP[i][j][k]>max){
                    max=settings->retrieval.NOISE.IWLP[i][j][k];
                }
            }
        }
    }

    return max;
}
